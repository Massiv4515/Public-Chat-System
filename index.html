<!DOCTYPE html>
<html>
<head>

    <style>
        body {
        background: linear-gradient(135deg, #0f172a, #111111);
        display: flex;
        justify-content: center;   /* center horizontally */
        align-items: center;       /* center vertically */
        height: 100vh;
        margin: 0;
        font-family: Inter, Arial, sans-serif;
        color: #e5e5e5;
        }

        .chat-box {
        width: 30%;
        height: 70%;
        background: #1e1e1e;
        border-radius: 18px;
        display: flex;
        flex-direction: column;
        overflow: hidden;

        /* depth */
        box-shadow: 0 20px 40px rgba(0,0,0,.5), 
                    inset 0 0 0 1px rgba(255,255,255,.05);
        }

        .chat-header {
        padding: 12px;
        text-align: center;
        background: linear-gradient(135deg, #1f2937, #0f172a);
        font-weight: 600;
        letter-spacing: .5px;
        border-bottom: 1px solid #2f2f2f;
        }

        #messages {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
        font-size: 14px;
        }

        /* subtle scroll bar */
        #messages::-webkit-scrollbar {
        width: 6px;
        }
        #messages::-webkit-scrollbar-thumb {
        background: #2f2f2f;
        border-radius: 20px;
        }

        .message {
        margin-bottom: 8px;
        padding: 8px 10px;
        background: #262626;
        border-radius: 10px;
        max-width: 98%;

        /* subtle glow on hover */
        transition: background .2s, transform .1s;
        }
        .message:hover {
        background: #2d2d2d;
        transform: translateX(2px);
        }

        .chat-input {
        display: flex;
        border-top: 1px solid #2f2f2f;
        }

        .chat-input input {
        flex: 1;
        padding: 12px;
        border: none;
        outline: none;
        background: #2a2a2a;
        color: #e5e5e5;
        }

        .chat-input button {
        padding: 0 18px;
        border: none;
        cursor: pointer;
        background: #22c55e;        /* lively green accent */
        color: #062a14;
        font-weight: bold;

        transition: background .2s, transform .1s;
        }

        .chat-input button:hover {
        background: #34d399;
        transform: scale(1.04);
        }

        .time {
            color: #92b895;     /* gray */
        }

        .callsign {
            color: #ca85b5;     /* teal-ish for others */
            font-weight: bold;
        }

        .me .callsign {
            color: #60a5fa;     /* YOUR callsign = blue */
        }

        .text {
            color: #e5e5e5;
        }

    </style>

</head>

<body>


  <div
    style="
        position: fixed;
        top: 55px;
        left: 50%;
        transform: translateX(-53%);
        width: 420px;      
    "
  >
    <input id="callsign" placeholder="Enter your callsign..."
        style="
        width: 100%;
        padding: 10px;
        border-radius: 10px;
        border: none;
        outline: none;
        background:#2a2a2a;
        color:white;
        ">
  </div>


  <div class="chat-box">
    <div class="chat-header">MRP Chat - Prototype</div>

    <div id="messages"></div>

    <div class="chat-input">
      <input id="msg" placeholder="Press 'T' to type..." />
      <button onclick="send()">Send</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "",
      authDomain: "",
      projectId: "",
      storageBucket: "",
      messagingSenderId: "",
      appId: "",
      databaseURL: ""
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const messagesDiv = document.getElementById("messages");
    const inputEl = document.getElementById("msg");
    const callsignEl = document.getElementById("callsign");

    window.send = function () {
      const input = document.getElementById("msg");
      const text = input.value.trim();
      const callsign = callsignEl.value.trim();

      if (!text) return;
      if (!callsign) {
        alert("Please enter your callsign first.");
        callsignEl.focus();
        return;
      }


      push(ref(db, "messages"), {
        text,
        time: Date.now(),
        callsign
      });


      input.value = "";
      input.blur();
    };

    callsignEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
            e.preventDefault();
            callsignEl.blur();
        }
    });



    // send message when pressing Enter
    document.getElementById("msg").addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
            e.preventDefault();

            const text = inputEl.value.trim();

            if (text === "") {
                // empty â†’ just unfocus
                inputEl.blur();
                return;
            }

            send();
        }
    });


    // Press T to start typing
    window.addEventListener("keydown", (e) => {
        // ignore if already typing
        if (
            document.activeElement === inputEl ||
            document.activeElement === callsignEl
        ) return;

        if (e.key === "t" || e.key === "T") {
            e.preventDefault();   // stop page/game from using T
            inputEl.focus();
        }
    });


    onChildAdded(ref(db, "messages"), (snapshot) => {
      const msg = snapshot.val();
      const div = document.createElement("div");
      div.className = "message";


      const date = new Date(msg.time);
      const localTime = date.toLocaleTimeString([], {
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      });

      // mark messages that belong to YOU
      const myCallsign = callsignEl.value.trim();
      if (msg.callsign === myCallsign) {
        div.classList.add("me");
      }

      div.innerHTML = `
        <span class="time">[${localTime}]</span>
        &nbsp;
        <span class="callsign">${msg.callsign}:</span>
        &nbsp;
        <span class="text">${msg.text}</span>
      `;


      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;      // auto scroll to bottom
    });
  </script>

</body>
</html>
